<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´ë“œë‰´ìŠ¤ ì´ë¯¸ì§€ ë¡œë”© ë””ë²„ê·¸</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .test-image { max-width: 300px; margin: 10px; border: 2px solid #ccc; }
        .success { border-color: green; }
        .error { border-color: red; }
        .loading { border-color: orange; }
        .info { background: #f0f8ff; padding: 10px; margin: 10px 0; border-radius: 3px; }
        .debug { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>ğŸ” ì¹´ë“œë‰´ìŠ¤ ì´ë¯¸ì§€ ë¡œë”© ë””ë²„ê·¸</h1>
    
    <div class="info">
        <strong>í˜„ì¬ í˜ì´ì§€ URL:</strong> <span id="currentUrl"></span><br>
        <strong>ë² ì´ìŠ¤ URL:</strong> <span id="baseUrl"></span>
    </div>

    <div class="test-section">
        <h2>1. ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸</h2>
        <div id="serverStatus">í…ŒìŠ¤íŠ¸ ì¤‘...</div>
    </div>

    <div class="test-section">
        <h2>2. ì •ì  íŒŒì¼ ê²½ë¡œ í…ŒìŠ¤íŠ¸</h2>
        <div>
            <h3>ë¡œê³  ì´ë¯¸ì§€ (ê¸°ë³¸):</h3>
            <img src="/images/logo.png" alt="ë¡œê³ " class="test-image loading" onload="this.className='test-image success'" onerror="this.className='test-image error'">
            <div class="debug">ê²½ë¡œ: /images/logo.png</div>
        </div>
        
        <div>
            <h3>ì—…ë¡œë“œ ì´ë¯¸ì§€ë“¤:</h3>
            <img src="http://localhost:9000/uploads/cardnews_01.jpg" alt="ì¹´ë“œë‰´ìŠ¤ 1" class="test-image loading" onload="this.className='test-image success'" onerror="this.className='test-image error'">
            <div class="debug">ê²½ë¡œ: http://localhost:9000/uploads/cardnews_01.jpg</div>
            
            <img src="http://localhost:9000/uploads/cardnews_02.jpg" alt="ì¹´ë“œë‰´ìŠ¤ 2" class="test-image loading" onload="this.className='test-image success'" onerror="this.className='test-image error'">
            <div class="debug">ê²½ë¡œ: http://localhost:9000/uploads/cardnews_02.jpg</div>
            
            <img src="http://localhost:9000/uploads/test-cardnews-1.jpg" alt="í…ŒìŠ¤íŠ¸ ì¹´ë“œë‰´ìŠ¤ 1" class="test-image loading" onload="this.className='test-image success'" onerror="this.className='test-image error'">
            <div class="debug">ê²½ë¡œ: http://localhost:9000/uploads/test-cardnews-1.jpg</div>
        </div>
    </div>

    <div class="test-section">
        <h2>3. API í…ŒìŠ¤íŠ¸</h2>
        <div id="apiStatus">í…ŒìŠ¤íŠ¸ ì¤‘...</div>
        <div id="apiResult"></div>
    </div>

    <div class="test-section">
        <h2>4. ì¹´ë“œë‰´ìŠ¤ ì‹¤ì œ ë°ì´í„°</h2>
        <div id="cardNewsData">ë¡œë”© ì¤‘...</div>
    </div>

    <script>
        // í˜„ì¬ URL ì •ë³´ í‘œì‹œ
        document.getElementById('currentUrl').textContent = window.location.href;
        document.getElementById('baseUrl').textContent = window.location.origin;

        console.log('ğŸ” ë””ë²„ê¹… ì‹œì‘');
        console.log('í˜„ì¬ URL:', window.location.href);
        console.log('ë² ì´ìŠ¤ URL:', window.location.origin);

        // 1. ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testServerConnection() {
            try {
                const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
                // API ì„¤ì • - config.jsì—ì„œ ë¡œë“œëœ ì„¤ì • ì‚¬ìš©
const API_BASE = window.API_BASE;
                const response = await fetch(`${API_BASE}/card-news?limit=1`);
                if (response.ok) {
                    document.getElementById('serverStatus').innerHTML = 'âœ… ì„œë²„ ì—°ê²° ì„±ê³µ (Status: ' + response.status + ')';
                    return true;
                } else {
                    document.getElementById('serverStatus').innerHTML = 'âŒ ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜ (Status: ' + response.status + ')';
                    return false;
                }
            } catch (error) {
                document.getElementById('serverStatus').innerHTML = 'âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ' + error.message;
                console.error('ì„œë²„ ì—°ê²° ì‹¤íŒ¨:', error);
                return false;
            }
        }

        // 2. API í…ŒìŠ¤íŠ¸
        async function testAPI() {
            try {
                document.getElementById('apiStatus').innerHTML = 'ğŸ”„ API í˜¸ì¶œ ì¤‘...';
                
                const response = await fetch(`${API_BASE}/card-news?limit=3`);
                const data = await response.json();
                
                console.log('API ì‘ë‹µ:', data);
                
                if (data.success && data.data && data.data.length > 0) {
                    document.getElementById('apiStatus').innerHTML = 'âœ… API í˜¸ì¶œ ì„±ê³µ (' + data.data.length + 'ê°œ ì•„ì´í…œ)';
                    
                    let html = '<h3>API ì‘ë‹µ ë°ì´í„°:</h3>';
                    data.data.forEach((item, index) => {
                        html += `<div class="debug">
                            <strong>ì¹´ë“œë‰´ìŠ¤ ${index + 1}:</strong><br>
                            ì œëª©: ${item.title}<br>
                            ì²¨ë¶€íŒŒì¼ ê°œìˆ˜: ${item.attachments ? item.attachments.length : 0}<br>
                        `;
                        
                        if (item.attachments && item.attachments.length > 0) {
                            html += 'ì²¨ë¶€íŒŒì¼ë“¤:<br>';
                            item.attachments.forEach((att, i) => {
                                html += `&nbsp;&nbsp;${i + 1}. ${att.filename} (${att.mimetype})<br>`;
                            });
                        }
                        html += '</div>';
                    });
                    
                    document.getElementById('apiResult').innerHTML = html;
                    return data.data;
                } else {
                    document.getElementById('apiStatus').innerHTML = 'âŒ API ë°ì´í„° ì—†ìŒ';
                    document.getElementById('apiResult').innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                    return null;
                }
            } catch (error) {
                document.getElementById('apiStatus').innerHTML = 'âŒ API í˜¸ì¶œ ì‹¤íŒ¨: ' + error.message;
                console.error('API í˜¸ì¶œ ì‹¤íŒ¨:', error);
                return null;
            }
        }

        // 3. ì¹´ë“œë‰´ìŠ¤ ì‹¤ì œ ë Œë”ë§ í…ŒìŠ¤íŠ¸
        async function testCardNewsRendering(cardData) {
            if (!cardData || cardData.length === 0) {
                document.getElementById('cardNewsData').innerHTML = 'âŒ ë Œë”ë§í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
                return;
            }

            let html = '<h3>ì‹¤ì œ ì¹´ë“œë‰´ìŠ¤ ë Œë”ë§:</h3>';
            
            cardData.forEach((card, index) => {
                const thumbnail = card.attachments?.find(att => att.mimetype?.startsWith('image/'));
                const thumbnailUrl = thumbnail ? `${API_BASE.replace('/api', '')}/uploads/${thumbnail.filename}` : `${API_BASE.replace('/api', '')}/images/logo.png`;
                const imageCount = card.attachments?.filter(att => att.mimetype?.startsWith('image/')).length || 0;
                
                html += `
                    <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px;">
                        <h4>${card.title}</h4>
                        <p>ì¹´í…Œê³ ë¦¬: ${card.category}</p>
                        <p>ì´ë¯¸ì§€ ê°œìˆ˜: ${imageCount}ì¥</p>
                        <p>ì¸ë„¤ì¼ ê²½ë¡œ: ${thumbnailUrl}</p>
                        <img src="${thumbnailUrl}" alt="${card.title}" class="test-image loading" 
                             onload="this.className='test-image success'; console.log('âœ… ì´ë¯¸ì§€ ë¡œë”© ì„±ê³µ:', '${thumbnailUrl}')" 
                             onerror="this.className='test-image error'; console.error('âŒ ì´ë¯¸ì§€ ë¡œë”© ì‹¤íŒ¨:', '${thumbnailUrl}')">
                    </div>
                `;
            });
            
            document.getElementById('cardNewsData').innerHTML = html;
        }

        // ìˆœì°¨ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        async function runAllTests() {
            console.log('ğŸš€ ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹œì‘');
            
            const serverOK = await testServerConnection();
            if (serverOK) {
                const cardData = await testAPI();
                await testCardNewsRendering(cardData);
            }
            
            console.log('âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        window.addEventListener('load', runAllTests);
    </script>
</body>
</html> 